 /*!
 * jQuery Tyle Player v0.1.0 - cardnews player
 * https://github.com/tyleteam/jquery-tyle-player
 *
 * Copyright 2016 Tubloo Co, Ltd. zidell and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: 2016-11-19
 */
!function(a){a.fn.tylePlayer=function(b,c){a.tylePlayer.init(a(this),b,c)},a.tylePlayer={isTouchable:!1,transitionTime:300,init:function(b,c,d){this.isTouchable="ontouchstart"in window||"onmsgesturechange"in window,/Edge\/|Trident\/|MSIE /.test(navigator.userAgent)&&(this.isTouchable=!1),void 0===typeof d&&(d={}),d=a.extend(!0,{width:510,height:510,background:"#000",enablePageIndicator:!0,enableFullscreen:!0,lastSlideLabel:"AI Design Tool",lastSlideLink:"https://tyle.io",onStart:function(){console.log("onStart")},onEnd:function(){console.log("onEnd")},onNext:function(a){console.log("next slideNo",a)},onPrev:function(a){console.log("prev slideNo",a)},onReplay:function(){console.log("replay")}},d);var e=[],f=c.length+30;c.map(function(a,b){e.push(['<div class="tyle-card index-',b,'" style="z-index:',f-b,';">','<div class="tyle-evt" style="background-image:url(',a,');"></div>',"</div>"].join(""))}),e.push(['<div class="tyle-card index-100" style="z-index:1;">','<div class="tyle-evt"></div>',"</div>"].join(""));var g="";""!==d.lastSlideLabel&&(g='<a class="tyle-btn-link">'+d.lastSlideLabel+"</a>"),$player=a(['<div class="tyle-card-wrapper">','<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" class="tyle-ratio">','<div class="tyle-progress-bar" data-rows="',c.length,'">',"1/",c.length,"</div>",'<div class="tyle-play-wrapper">',e.join(""),"</div>",'<div class="tyle-first-slide">',"Slide to next >","</div>",'<div class="tyle-fullscreen tyle-btn">',"</div>",'<div class="tyle-last-slide">','<a class="tyle-btn-replay">','<span class="tyle-btn-replay">',"Replay","</span>",g,"</a>","</div>","</div>"].join(""));for(var h in d)$player.data(h,d[h]);$player.addClass("indicator-"+(d.enablePageIndicator?"y":"n")),$player.addClass("fullscreen-enabled-"+(d.enableFullscreen?"y":"n")),this.resize($player),b.empty().append($player),this.initDom($player)},resize:function(a){var b=a.data("width"),c=a.data("height");a.css({"max-width":b+"px","max-height":c+"px"})},initDom:function(a){a.find(".tyle-card").first().addClass("tyle-active").next().addClass("tyle-prepare").css({transform:"translate3d(0, 0, -100px)",opacity:1}),this.isTouchable||(a.find(".tyle-first-slide"),a.addClass("no-touch")),a.addClass("now-index-1"),this.bindingEvents(a),a.data("onStart")()},bindingEvents:function(b){b.on("touchstart.tyle mousedown.tyle",function(a){return a.preventDefault(),a.stopPropagation(),!(a.target.className.indexOf("tyle-btn")>-1)&&void jQuery.tylePlayer.events.touchStart(this,jQuery.tylePlayer.eventJudge(a).xPosition,jQuery.tylePlayer.eventJudge(a).yPosition)}).on("touchmove.tyle mousemove.tyle",function(a){return null!==jQuery.tylePlayer.touchStartX&&null!==jQuery.tylePlayer.touchStartY&&(!(a.target.className.indexOf("tyle-btn")>-1)&&jQuery.tylePlayer.events.touchMove(this,jQuery.tylePlayer.eventJudge(a).xPosition,jQuery.tylePlayer.eventJudge(a).yPosition))}).on("touchend.tyle mouseup.tyle",function(b){return b.target.className.indexOf("tyle-btn-replay")>-1?(jQuery.tylePlayer.events.replay(a(this).closest(".tyle-card-wrapper")),!1):b.target.className.indexOf("tyle-btn-link")>-1?(jQuery.tylePlayer.events.link(a(this).closest(".tyle-card-wrapper")),!1):!(null===jQuery.tylePlayer.touchStartX||b.target.className.indexOf("tyle-btn")>-1)&&(jQuery.tylePlayer.events.touchEnd(this),jQuery.tylePlayer.touchStartX=null,void(jQuery.tylePlayer.touchStartY=null))}),b.find(".tyle-fullscreen").on("click.tyle",function(b){return a(this).parents(".tyle-card-wrapper").toggleClass("fullscreen"),!1})},events:{touchStart:function(a,b,c){jQuery.tylePlayer.touchStartX=jQuery.tylePlayer.touchMoveX=b,jQuery.tylePlayer.touchStartY=jQuery.tylePlayer.touchMoveY=c},touchMove:function(b,c,d){jQuery.tylePlayer.touchMoveX=c,jQuery.tylePlayer.touchMoveY=d;var e=jQuery.tylePlayer.touchStartX-jQuery.tylePlayer.touchMoveX,f=jQuery.tylePlayer.touchStartY-jQuery.tylePlayer.touchMoveY,g=a(b).find(".tyle-active"),h=e>0?"left":e<0?"right":"",i=a(b).outerWidth();e=Math.abs(e);var j=100*e/i-100,k=1+j/100;return"right"==h?(k=1-k,g.prev().addClass("tyle-moving").css({transform:"translate3d("+(i*-1+e)+"px, "+f*-.5+"px, 0)",opacity:1*e/i}).next().css({transform:"translate3d(0, 0, "+(j*-1-100)+"px)"}).next().removeClass("tyle-prepare")):"left"==h&&g.addClass("tyle-moving").css({transform:"translate3d("+e*-1+"px, "+f*-.5+"px, 0)",opacity:(i-1*e)/i}).next().css({transform:"translate3d(0, 0, "+j+"px)"}),!(""!=h&&e>10)},touchEnd:function(b){var c=jQuery.tylePlayer.touchStartX-jQuery.tylePlayer.touchMoveX,d=jQuery.tylePlayer.touchStartY-jQuery.tylePlayer.touchMoveY,e=a(b).find(".tyle-active"),f=c>0?"left":c<0?"right":"tap";c=Math.abs(c);var g=30;if("right"==f){var h=e.prev().removeClass("tyle-moving").addClass("tyle-transitionable");c<g?(console.log("뒤로가기 취소"),h.css({transform:"translate3d("+a(b).outerWidth()*-1+"px, 0, 0)",opacity:0}),setTimeout(function(){h.removeClass("tyle-transitionable")},jQuery.tylePlayer.transitionTime)):(console.log("뒤로가기 실행"),jQuery.tylePlayer.move(e,"prev",d))}else e.removeClass("tyle-moving").addClass("tyle-transitionable"),c<5||c>g?(console.log("다음으로가기 실행"),0==c&&(a(b).addClass("tapping"),setTimeout(function(){a(b).removeClass("tapping")},300)),jQuery.tylePlayer.move(e,"next",d)):(console.log("다음으로가기 취소"),e.css({transform:"translate3d(0, 0, 0)",opacity:1}),setTimeout(function(){e.removeClass("tyle-transitionable")},jQuery.tylePlayer.transitionTime))},replay:function(a){a.removeClass("tyle-last"),a.find(".tyle-active").removeClass("tyle-active"),a.find(".tyle-prepare").removeClass("tyle-prepare");var b=a.find(".tyle-card").first().addClass("tyle-active").css({transform:"translate3d(0, 0, 0)",opacity:1});b.next().addClass("tyle-prepare").css({transform:"translate3d(0, 0, -100px)",opacity:1}),a.data("onReplay")(),jQuery.tylePlayer.move(b,"")},link:function(a){var b=a.data("lastSlideLink"),c=window.open(b,"_blank");c.focus()}},move:function(a,b,c){if("undefined"==typeof c&&(c=0),"prev"==b){var d=a.prev();if(0==d.length)return!1;d.css({transform:"translate3d(0, 0, 0)",opacity:1}).addClass("tyle-active"),d.next().removeClass("tyle-active").addClass("tyle-transitionable").css({transform:"translate3d(0, 0, -100px)"}),setTimeout(function(){d.removeClass("tyle-transitionable").next().removeClass("tyle-transitionable").addClass("tyle-prepare")},jQuery.tylePlayer.transitionTime);var e=d.parents(".tyle-card-wrapper")}else if("next"==b){a.css({transform:"translate3d("+a.outerWidth()*-1+"px, "+2*c*-1+"px, 0)",opacity:0}).removeClass("tyle-active");var d=a.next();if(0==d.length)return setTimeout(function(){a.addClass("tyle-active").css({transform:"translate3d(0, 0, 0)",opacity:1}),setTimeout(function(){a.removeClass("tyle-transitionable")},jQuery.tylePlayer.transitionTime)},20),!1;d.addClass("tyle-active").addClass("tyle-transitionable").css({transform:"translate3d(0, 0, 0)"}).removeClass("tyle-prepare"),$preload=d.next().css({transform:"translate3d(0, 0, -100px)",opacity:1});var e=d.parents(".tyle-card-wrapper");setTimeout(function(){a.removeClass("tyle-transitionable").next().removeClass("tyle-transitionable").next().addClass("tyle-prepare")},jQuery.tylePlayer.transitionTime)}else var d=a,e=d.parents(".tyle-card-wrapper");var f=d.index();this.replaceClass(e,"now-index-",f+1);var g=e.find(".tyle-progress-bar"),h=g.data("rows"),i=f+1;g.html(i+"/"+h),i>=h+1?(e.addClass("tyle-last"),e.data("onEnd")()):(e.removeClass("tyle-last"),e.data("next"===b?"onNext":"onPrev")(i))},replaceClass:function(b,c,d){var e=b.attr("class").split(/\s+/);a.each(e,function(a,d){d.indexOf(c)>-1&&b.removeClass(d)}),b.addClass(c+d)},eventJudge:function(a){if(this.isTouchable)var b=a.originalEvent.touches[0].pageX,c=a.originalEvent.touches[0].pageY;else var b=a.pageX,c=a.pageY;return{xPosition:b,yPosition:c}}}}(jQuery);